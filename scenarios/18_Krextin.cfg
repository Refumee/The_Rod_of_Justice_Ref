
[scenario]
    id="18_Krextin"
    name= _ "Krextin"
    map_data="{~add-ons/The_Rod_of_Justice/maps/18_Krextin.map}"
    next_scenario="19_Belly_of_the_Beast"
    
    victory_when_enemies_defeated=no
    
    {UNDERGROUND}
    
    {INTRO_AND_SCENARIO_MUSIC underground.ogg suspense.ogg}
    {EXTRA_SCENARIO_MUSIC the_deep_path.ogg}
    {TURNS 70 65 60}
    
    [story]
        
        [part]
            story= _ "After the battle was won, we bid Skaikleely farewell. He and his remaining troops left the hills to attempt an escape to Amurlai. As soon as he told me that Lord Chamilix had been captured as well, I... I can only hope that I do not lose him, too. I have been telling myself that I shall rescue him, that all will be well, and that I shall see him and Adria returned to me safely. I am too afraid to comtemplate any other outcome."
        [/part]
        
        [part]
            story= _ "Mal Idyr and I decided to take only our most skilled and loyal soldiers into Krextin with us - lest we suffer heavy losses or alert the demons to our presence with too large a company. So now, the majority of our army waits amidst the hills and small lakes we just cleared of enemies."
        [/part]
        
        [part]
            story= _ "The water elementalists we encountered there seem to be the same ones the Sentinels mentioned. How they managed to conjure elementals like those in the desert remains a mystery, though - as does who or what they work for, aside from the nebulous 'King of Tides' that they mentioned. If our battles thus far have taught us anything, it's that we have no shortage of competitors for the Rod."
        [/part]
        
        [part]
            story= _ "Nevertheless, I cannot dwell on faraway enemies when we must be ready to confront those nearest to us. The leeches have grown more and more uncomfortable the closer we get to Krextin, shrieking and hissing in nearly unbearbale pitches in these caves. My ears are still ringing from it - I'd rather have a siren whistle directly in my ear than endure that again."
        [/part]
        
    [/story]
    
    {ROD_DEATH}
    
    [side]
        type=Silver Lord
        id=Devanar
        name= _ "Devanar"
        unrenamable=yes
        profile=portraits/devanar.png
        side=1
        canrecruit=yes
        team_name=good
        user_team_name=_"New Elensia"
        controller=human
        {GOLD 120 120 120}
        {INCOME 0 0 0}
        {FLAG_VARIANT long}
        shroud=yes
    [/side]
    
    [side]
        side=2
        team_name="bad"
        user_team_name= _ "Edangor"
        {FLAG_VARIANT ragged}
        id="Rofocas"
        name= _ "Rofocas"
        unrenameable=yes
        canrecruit=yes
        type="Gutwrencher Imp"
        facing=se
        {GOLD 150 200 250}
        {INCOME 16 18 20}
        controller=ai
        canrecruit=yes
        recruit="Minor Imp, Imp, Blood Imp"
        hidden=yes
        
        [unit]
            id=The Houndkeeper
            name= _ "The Houndkeeper"
            unrenameable=yes
            upkeep=free
            type="Chaos Soulhunter"
            ai_special=guardian
            x=45
            y=26
            facing=se
        [/unit]
        
        [unit]
            id=Champion
            name= _ "Edangor's Champion"
            unrenameable=yes
            upkeep=free
            type="Chaos Sharpshooter"
            ai_special=guardian
            x=27
            y=26
            facing=se
        [/unit]
        
        {LOYAL_UNIT 2 (Skeleton) 46 48} {GUARDIAN}
        {LOYAL_UNIT 2 (Deathblade) 51 48} {GUARDIAN}
        {LOYAL_UNIT 2 (Water Serpent) 34 61} {GUARDIAN}
        {LOYAL_UNIT 2 (Water Serpent) 54 37} {GUARDIAN}
        {LOYAL_UNIT 2 (Dread Bat) 31 32} {GUARDIAN}
        {LOYAL_UNIT 2 (Dread Bat) 37 39} {GUARDIAN}
        {LOYAL_UNIT 2 (Dread Bat) 48 36} {GUARDIAN}
        {LOYAL_UNIT 2 (Giant Cockroach) 45 22} {GUARDIAN}
        {LOYAL_UNIT 2 (Giant Cockroach) 34 46} {GUARDIAN}
        {LOYAL_UNIT 2 (Giant Cockroach) 33 39} {GUARDIAN}
        {LOYAL_UNIT 2 (Giant Cockroach) 45 38} {GUARDIAN}
        {GENERIC_UNIT 2 (Giant Spider0) 53 26} {GUARDIAN}
        {GENERIC_UNIT 2 (Giant Spider0) 26 56} {GUARDIAN} {FACING sw}
        {GENERIC_UNIT 2 (Giant Rat) 18 58} {GUARDIAN} {FACING se}
        
        [unit]
            id=Bezmus
            name= _ "Bezmus"
            unrenameable=yes
            upkeep=free
            type="Blood Imp"
            ai_special=guardian
            x=31
            y=18
            facing=se
        [/unit]
        
        [unit]
            id=Oulf
            name= _ "Oulf"
            unrenameable=yes
            upkeep=free
            type="Blood Imp"
            ai_special=guardian
            x=33
            y=18
            facing=se
        [/unit]
        
        [unit]
            id=Bue
            name= _ "Bue"
            unrenameable=yes
            upkeep=free
            type="Blood Imp"
            ai_special=guardian
            x=33
            y=9
            facing=se
        [/unit]
        
        [unit]
            id=Mep
            name= _ "Mep"
            unrenameable=yes
            upkeep=free
            type="Blood Imp"
            ai_special=guardian
            x=33
            y=11
            facing=se
        [/unit]
        
        [unit]
            id=Rah
            name= _ "Rah"
            unrenameable=yes
            upkeep=free
            type="Blood Imp"
            ai_special=guardian
            x=23
            y=11
            facing=se
        [/unit]
        
        [unit]
            id=Zoreal
            name= _ "Zoreal"
            unrenameable=yes
            upkeep=free
            type="Blood Imp"
            ai_special=guardian
            x=23
            y=13
            facing=se
        [/unit]
        
        
        [unit]
            id=Oros
            name= _ "Oros"
            unrenameable=yes
            upkeep=free
            type="Blood Imp"
            ai_special=guardian
            x=12
            y=7
            facing=se
        [/unit]
        
        [unit]
            id=Kunochovan
            name= _ "Kunochovan"
            unrenameable=yes
            upkeep=free
            type="Blood Imp"
            ai_special=guardian
            x=10
            y=8
            facing=se
        [/unit]
        
        {VILLAGE 7 3}
        {VILLAGE 9 4}
        {VILLAGE 5 6}
        {VILLAGE 7 7}
        
        [ai]
            time_of_day=underground
            aggression=0.99
            caution=0.01
        [/ai]
        
    [/side]
    
    [event]
        name="prestart"
        
        [place_shroud]
            x=0-58
            y=0-67
        [/place_shroud]
        
        {PLACE_IMAGE scenery/signpost.png 1 1}
        
        {PLACE_IMAGE scenery/trapdoor-open.png 8 64}
        
        {PLACE_IMAGE scenery/magic-gate-se.png 16 58}
        {PLACE_IMAGE scenery/magic-gate-se.png 17 58}
        
        {PLACE_IMAGE scenery/magic-gate-se.png 11 61}
        {PLACE_IMAGE scenery/magic-gate-se.png 12 60}
        
        {PLACE_IMAGE scenery/magic-gate-se.png 15 63}
        {PLACE_IMAGE scenery/magic-gate-se.png 16 62}
        
        {PLACE_IMAGE scenery/magic-gate-se.png 20 60}
        {PLACE_IMAGE scenery/magic-gate-se.png 21 60}
        
        {PLACE_IMAGE scenery/rune3.png 9 64}
        {PLACE_IMAGE scenery/rune5.png 27 55}
        
        {PLACE_IMAGE scenery/tub.png 16 63}
        {PLACE_IMAGE scenery/tub.png 11 60}
        {PLACE_IMAGE scenery/tub.png 16 57}
        {PLACE_IMAGE scenery/tub.png 21 61}
        
        
        {PLACE_IMAGE items/altar-evil.png 55 19}
        {PLACE_IMAGE scenery/blood-trail-1.png 17 59}
        {PLACE_IMAGE scenery/blood-trail-1.png 55 20}
        
        {PLACE_IMAGE items/spear-fancy.png 53 20}
        
        {PLACE_IMAGE items/ring-silver.png 27 26}
        
        [recall]
            id="Raourshin Ohn"
            x=6
            y=64
        [/recall]
        
        [recall]
            id="Mal Idyr"
            x=8
            y=65
        [/recall]
        
        [recall]
            id="Mergubraesh"
            x=5
            y=66
        [/recall]
        
        [recall]
            id="Arthyn"
            x=12
            y=64
        [/recall]
        
        [recall]
            id="Afiriah"
            x=6
            y=63
        [/recall]
        
        [recall]
            id="Kalassa"
            x=10
            y=65
        [/recall]
        
        [recall]
            id="Haradd"
            x=8
            y=66
        [/recall]
        
        [recall]
            id="Mercy"
            x=4
            y=64
        [/recall]
        
        [recall]
            id="Geonn"
            x=5
            y=64
        [/recall]
        
        [recall]
            id="Kronak"
            x=8
            y=62
        [/recall]
		{RECALL_OR_NAMED_GENERIC_UNIT (
		    id=Guard
            x,y=10,63)(
		    id=Guard
            x,y=10,63)(
		[role]
            id=Guard
            role=Navigator
        [/role])(
		
        [role]
            type=Ref Saurian Stillwater,Ref Saurian Mireblade,Saurian Explorer,Saurian Pathfinder,Aragwaith Swordsman, Aragwaith Longswordsman, Aragwaith Swordsmaster, Aragwaith Guard, Aragwaith Shield Guard, Aragwaith Archer, Aragwaith Strongbow, Aragwaith Slayer, Aragwaith Greatbow
            role=Navigator
        [/role]
        
        [recall]
            role=Navigator
            x=10
            y=63
        [/recall])}
        
        # Give the player a free recall of a saurian healer, as S18 and S19 will be very difficult without at least two veteran medics.
        # Ideally, Kalassa, our loyal Aragwaith Witch from S7, is still alive at this point and has become a Sorceress, but just in case.
        # Preferably a Soothsayer if the player has one, if not, then an Augur that may have the chance to advance to Soothsayer, or, if
        # the player has neither Soothsayers nor Augurs in their recall list, then an Oracle as a last option,
        # prioritizing heals, cures +8 over heals +4.
        
        [role]
            type=Saurian Seer, Saurian Soothsayer, Saurian Augur, Saurian Prophet, Saurian Oracle
            role=FreeHealer
        [/role]
        
        [recall]
            role=FreeHealer
            x=9
            y=63
        [/recall]
        
		#ifdef EASY
		
			#define TROJ_HELLHOUND
			"Chaos Hound"#enddef
		
		#endif
		#ifdef NORMAL
		
			#define TROJ_HELLHOUND
			"Demonic Hound"#enddef
		
		#endif
		#ifdef HARD
		
			#define TROJ_HELLHOUND
			Hellhound#enddef
		
		#endif
		
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 19 64}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 18 63}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 17 63}
        
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 16 65}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 15 65}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 14 64}
        
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 11 58}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 13 59}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 12 58}
        
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 8 59}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 9 60}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 10 60}
        
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 13 57}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 14 57}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 15 58}
        
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 16 55}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 17 56}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 18 56}
        
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 22 60}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 23 61}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 24 61}
        
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 19 62}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 20 62}
        {LOYAL_UNIT 2 {TROJ_HELLHOUND} 21 63}
        
        [object]
            
            
            silent=yes
            duration=forever
            [filter]
                id=Champion
            [/filter]
            [effect]
                apply_to=hitpoints
                increase=40
                increase_total=40
            [/effect]
        [/object]
        
        [heal_unit]
            [filter]
                id=Champion
            [/filter]
            amount=full
        [/heal_unit]
        
        {VARIABLE got_champion_ring no}
        
    [/event]
    
    
    [event]
        name=moveto
        [filter]
            side=1
            x,y=27,26
        [/filter]
        [if]
            [variable]
                name=got_champion_ring
                boolean_equals=no
            [/variable]
            [then]
                {INCIDENTAL_MUSIC "heroes_rite.ogg"}
                
                [message]
                    speaker=Devanar
                    message= _ "Edangor's champion seems to have dropped this here..."
                [/message]
                
                [message]
                    speaker=Raourshin Ohn
                    message= _ "Hmm, it seems too small to fit around one of my claws."
                [/message]
                
                [message]
                    speaker=Mal Idyr
                    message= _ "Devanar, given that you already have the Rod of Justice, and I have the Soul Jewel, this artifact might best suit one of our soldiers, perhaps a loyal individual whose skills would complement the ring's power best in the coming battles."
                [/message]
                
            [/then]
        [/if]
    [/event]
    
	#Ring of the Chaos Champion
	[event]
		name=moveto
		first_time_only=no
		id=champion_ring
        [filter]
            side=1
            x,y=27,26
            [not]
                id=Devanar, Mal Idyr, Raourshin Ohn
            [/not]
            [not]
                race=drake
            [/not]
        [/filter]
		[if]
			[have_unit]
				x,y=27,26
			[/have_unit]
			[then]
				[item_dialog]
					name,image= _ "Ring of the Chaos Champion",icons/jewelry_ring_prismatic.png
					description,effect= _ "This enchanted, or perhaps corrupted, ring once belonged to Demon Lord Edangor's foremost warrior, who was likely the only human in Edangor's employ that he respected and trusted to carry out his orders: Kareos, the Chaos Champion. Though the deeper accesses of its power are not fully known to those outside of the Chaos Empire, wearing the ring will immediately grant the wearer heightened vitality, dexterity, strength, and agility. Owners of these types of artifacts are, unsurprisingly, considered the champions of their commanders' forces, often among or at the acme and apex of their peer's combat skills. Choose carefully, brave hero. This mysterious item should go to your most capable, trusted, and lethal warrior or mage.",{INTERNAL:SPECIAL_NOTES_CHAOS_CHAMPION_RING}
					take_string=_"Take it"
					leave_string=_"Leave it"
				[/item_dialog]
					[if]
						[variable]
							name=item_picked
							equals=yes
						[/variable]
						[then]
							[remove_event]
								id=champion_ring
							[/remove_event]
							{TRoJ_CHAOS_CHAMPION_RING x,y=27,26 champion_ring}
                            [message]
                                speaker=Devanar
                                message= _ "You should take it, $unit.name|. I hereby declare you champion of my army!"
                            [/message]
                            
                            [message]
                                speaker=unit
                                message= _ "My lord! I... I am honored to know that you find me worthy, and accept the charge with great humility."
                            [/message]
                            
                            [message]
                                speaker=unit
                                message= _ "It's hauntingly powerful. I can feel the energy emanating from the metal itself!"
                            [/message]
							{VARIABLE got_champion_ring yes}
						[/then]
					[/if]
			[/then]
		[/if]
	[/event]
	
    [event]
        name=start
        
        [message]
            speaker=Raourshin Ohn
            message= _ "As instructed, the bulk of our army now remains in the hills. There are a few more of us crawling up from down below, but once we've all arrived, the mission shall commence."
        [/message]
        
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "During the first turn only, you may recruit and/or recall up to six units. Along with your brave heroes, loyal units, one of your saurian healers, and your navigator, these will be the only soldiers available to you during the infiltration of Krextin."
        [/message]
        
        [message]
            speaker="Devanar"
            message= _ "You hail from Krextin, and know it well?"
        [/message]
        
        [message]
            role=Navigator
            message= _ "Indeed. Born and raised, sire. Between myself and Mal Idyr, we should be able to delve further into the inner keep, and locate Adria and Chamilix."
        [/message]
        
        [message]
            speaker="Mal Idyr"
            message= _ "Allow me to manipulate the glyphs, Devanar. Krextin's magical infrastucture may have changed since its capture, and I know it best."
        [/message]
        
        [message]
            speaker="Devanar"
            message= _ "Very well, my lord. Let us not tarry here any longer than need be. Thousands of lives depend on us."
        [/message]
        
        [message]
            speaker="Mal Idyr"
            message= _ "Is it thousands of lives that motivate you, or just two in particular?"
        [/message]
        
        [message]
            speaker="Devanar"
            message= _ "What was that, my lord? My ears still ache from the leechs' wailing."
        [/message]
        
        [message]
            speaker="Mal Idyr"
            message= _ "Hmm? Ah, nothing, Devanar. Just rehearsing the incantation that activates the glyphs."
        [/message]
        
        [objectives]
            side=1
            [objective]
                description= _ "Navigate Krextin"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Devanar"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Raourshin Ohn"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Mal Idyr"
                condition=lose
            [/objective]
            
            {TURNS_RUN_OUT}
            
            [gold_carryover]
                bonus=no
                carryover_percentage=0
            [/gold_carryover]
        [/objectives]
    [/event]
    
    [event]
        name=moveto
        [filter]
            x=9
            y=64
            id=Mal Idyr
        [/filter]
        
        {HIGHLIGHT_IMAGE 9 64 scenery/rune3-glow.png ()}
        
        [message]
            speaker=unit
            message= _ "Open."
        [/message]
        
        {MODIFY_TERRAIN Urb (11) (63)}
        {MODIFY_TERRAIN Urb (12) (62)}
        [redraw]
        [/redraw]
        
        {QUAKE "rumble.ogg"}
        
    [/event]
    
    [event]
        name=turn 2
        
        {MODIFY_TERRAIN Iwr (7) (64)}
        {MODIFY_TERRAIN Iwr (8) (64)}
        {MODIFY_TERRAIN Iwr (6) (64)}
        {MODIFY_TERRAIN Iwr (6) (65)}
        {MODIFY_TERRAIN Iwr (7) (66)}
        {MODIFY_TERRAIN Iwr (8) (65)}
        {MODIFY_TERRAIN Iwr (7) (65)}
        
        {REMOVE_IMAGE 8 64}
        
        {PLACE_IMAGE scenery/trapdoor-closed.png 8 64}
        
        [redraw]
        [/redraw]
        
        [sound]
            name=open-chest.wav
        [/sound]
        
        # disallow recruiting of everything
        [disallow_recruit]
            side=1
            type=Saurian Scout,Aragwaith Spearman,Saurian Augur,Aragwaith Archer,Aragwaith Swordsman,Giant Leech,Saurian Skirmisher,Rhocobone,Ghost,Drake Glider,Dark Adept
        [/disallow_recruit]
        
        # store all recalls
        
        [store_unit]
            [filter]
                side=1
                x,y=recall,recall
            [/filter]
            kill=yes
            variable=recall_list
        [/store_unit]
        
        # store player's gold until S21
        
        [store_side]
            side=1
        [/store_side]
        
        {VARIABLE krextin_gold $side.gold}
        {CLEAR_VARIABLE side}
        
        [modify_side]
            side=1
            gold=0
        [/modify_side]
        
        
        [if]
            [have_unit]
                id=Mergubraesh
            [/have_unit]
            [then]
                
                [message]
                    speaker="Mergubraesh"
                    message= _ "Skreeeee..."
                [/message]
                
                [message]
                    speaker="Devanar"
                    message= _ "Easy, girl."
                [/message]
                
                [message]
                    speaker="Mergubraesh"
                    message= _ "Thhhsssss!"
                [/message]
                
                [message]
                    speaker="Devanar"
                    message= _ "I wish I knew what has you so worried..."
                [/message]
                
            [/then]
            [else]
            [/else]
        [/if]
        
        
    [/event]
    
    [event]
        name=turn 3
        
        # Give players another hint that something is afoot.
        
        [message]
            role=Navigator
            message= _ "Great Gods, it reeks in here. Smells like wet dog."
        [/message]
        
    [/event]
    
    [event]
        name=moveto
        [filter]
            x=27
            y=55
            id=Mal Idyr
        [/filter]
        
        [message]
            speaker="Mal Idyr"
            message= _ "Open."
        [/message]
        
        [delay]
            time=2000
        [/delay]
        
        [message]
            speaker="Devanar"
            message= _ "Is all well, Mal Idyr?"
        [/message]
        
        [message]
            speaker="Mal Idyr"
            message= _ "Yes, Devanar! This insufferable door is just being incorrigibly difficult."
        [/message]
        
        [message]
            speaker="Mal Idyr"
            message= _ "Open!"
        [/message]
        
        [delay]
            time=1000
        [/delay]
        
        [message]
            speaker="Mal Idyr"
            message= _ "Dark Gods help me, I enchanted this glyph myself-"
        [/message]
        
        [delay]
            time=2000
        [/delay]
        
        [message]
            speaker="Mal Idyr"
            message= _ "Halt."
        [/message]
        
        [delay]
            time=2000
        [/delay]
        
        [message]
            speaker="Mal Idyr"
            message= _ "The energy loop on this passage has been tampered with, but-"
        [/message]
        
        [sound]
            name=magic-dark-big.ogg
        [/sound]
        
        [sound]
            name=gunshot.wav
        [/sound]
        
        [harm_unit]
            [filter]
                id=Mal Idyr
            [/filter]
            alignment=chaotic
            kill=no
            amount=23
            animate=yes
        [/harm_unit]
        
        [sound]
            name=lich-die.ogg
        [/sound]
        
        {INCIDENTAL_MUSIC "frantic.ogg"}
        
        [message]
            speaker="Devanar"
            message= _ "My lord!"
        [/message]
        
        
        {REMOVE_IMAGE 16 58}
        {REMOVE_IMAGE 17 58}
        
        {REMOVE_IMAGE 11 61}
        {REMOVE_IMAGE 12 60}
        
        {REMOVE_IMAGE 15 63}
        {REMOVE_IMAGE 16 62}
        
        {REMOVE_IMAGE 20 60}
        {REMOVE_IMAGE 21 60}
        
        {MODIFY_TERRAIN Rr (16) (58)}
        {MODIFY_TERRAIN Rr (17) (58)}
        {MODIFY_TERRAIN Rr (11) (61)}
        {MODIFY_TERRAIN Rr (12) (60)}
        {MODIFY_TERRAIN Rr (15) (63)}
        {MODIFY_TERRAIN Rr (16) (62)}
        {MODIFY_TERRAIN Rr (20) (60)}
        {MODIFY_TERRAIN Rr (21) (60)}
        
        [sound]
            name=gate-fall.ogg
        [/sound]
        
        [delay]
            time=250
        [/delay]
        
        [sound]
            name=gate-fall.ogg
        [/sound]
        
        [delay]
            time=250
        [/delay]
        
        [sound]
            name=gate-fall.ogg
        [/sound]
        
        [delay]
            time=250
        [/delay]
        
        [sound]
            name=gate-fall.ogg
        [/sound]
        
        
        [redraw]
        [/redraw]
        
        [message]
            speaker="Mal Idyr"
            message= _ "It's a trap! Gah... Erya must have learned about this passage somehow."
        [/message]
        
        [message]
            speaker="Devanar"
            message= _ "You said that only you and Lord Alazarik knew of this route!"
        [/message]
        
        [message]
            speaker="Mal Idyr"
            message= _ "Then perhaps Alazarik was a spy, or one of the refugees betrayed us! For all our sakes, I pray it was not the former."
        [/message]
        
        
        [sound]
            name=wolf-growl-2.ogg
        [/sound]
        
        [delay]
            time=250
        [/delay]
        
        [sound]
            name=wolf-growl-3.ogg
        [/sound]
        
        [delay]
            time=250
        [/delay]
        
        [sound]
            name=wolf-growl-1.ogg
        [/sound]
        
        [delay]
            time=250
        [/delay]
        
        [sound]
            name=wolf-growl-4.ogg
        [/sound]
        
        [sound]
            name=wolf-growl-3.ogg
        [/sound]
        
        [message]
            role=Navigator
            message= _ "My lords, we need to move, and fast! We're surrounded by their bloodthirsty hellhounds!"
        [/message]
        
        [message]
            speaker="Arthyn"
            message= _ "Those look a lot different from the hounds I used to hunt with..."
        [/message]
        
        [message]
            speaker="Mal Idyr"
            message= _ "Barriers, return to dust and quarry! Walls, collapse!"
        [/message]
        
        {MODIFY_TERRAIN Uh (29) (56)}
        {MODIFY_TERRAIN Uh (26) (53)}
        
        [redraw]
        [/redraw]
        
        {QUAKE "rumble.ogg"}
        
        [sound]
            name=gunshot.wav
        [/sound]
        
        [delay]
            time=500
        [/delay]
        
        [message]
            speaker="Devanar"
            message= _ "Which way say you?"
        [/message]
        
        # Easter egg mention: Parandra's warning to Valgatha in S13 about not trusting the water, which is meant to allude to future clashes with
        # the water elementalists, but also applies as a warning regarding the submerged guardian draug hidden along the eastern path.
        # Perhaps an attentive player with careful memory may recall this, and move their units west instead of east, if not, it's at least a fun detail.
        
        [message]
            role=Navigator
            message= _ "The right is a longer way around, and is partially flooded. If we're to attempt to bottleneck them and use the terrain to our defense, we could do so there. Alternatively, my lord, the left is littered with some rubble, but is mostly a straight shot right to Krextin's inner keep. If you'd like to make a run for it, or if you don't trust the water, that's another option. Or, we could split up, and see if the hounds divide themselves during the chase."
        [/message]
        
        [message]
            speaker="Devanar"
            message= _ "Good to know. Make haste then, my friends! I would not see you devoured by those creatures for being slow of foot!"
        [/message]
        
        [objectives]
            side=1
            [objective]
                description= _ "Travel north, further into Krextin"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Devanar"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Mal Idyr"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Raourshin Ohn"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
        [/objectives]
        
    [/event]
    
    
    [event]
        name=turn 7
        
        # In case the player happens to recall two or more spectres, and attempts to bottleneck the hellhounds, who even on 0.99 aggression are wary of
        # attacking spectres, create alternate routes for the hellhounds to get at Devanar and the rest of our questing heroes
        
        {MODIFY_TERRAIN Ur (25) (61)}
        {MODIFY_TERRAIN Ur (26) (60)}
        {MODIFY_TERRAIN Ur (27) (60)}
        {MODIFY_TERRAIN Ur (28) (59)}
        {MODIFY_TERRAIN Ur (29) (59)}
        
        {MODIFY_TERRAIN Ur (17) (55)}
        {MODIFY_TERRAIN Ur (18) (54)}
        {MODIFY_TERRAIN Ur (19) (54)}
        {MODIFY_TERRAIN Ur (20) (53)}
        {MODIFY_TERRAIN Ur (21) (53)}
        {MODIFY_TERRAIN Ur (22) (52)}
        {MODIFY_TERRAIN Ur (23) (52)}
        {MODIFY_TERRAIN Ur (24) (51)}
        
        {MODIFY_TERRAIN Ur (27) (57)}
        {MODIFY_TERRAIN Ur (28) (57)}
        {MODIFY_TERRAIN Ur (29) (58)}
        
        {MODIFY_TERRAIN Ur (23) (55)}
        {MODIFY_TERRAIN Ur (23) (54)}
        {MODIFY_TERRAIN Ur (24) (53)}
        
        [redraw]
        [/redraw]
        
        [sound]
            name=bot-huge-explosion.ogg
        [/sound]
        
        {QUAKE "rumble.ogg"}
        
        [message]
            speaker=Devanar
            message= _ "What do you reckon that was, Mal Idyr?"
        [/message]
        
        [message]
            speaker=Mal Idyr
            message= _ "With our luck thus far? Nothing good. Keep moving!"
        [/message]
        
    [/event]
    
    
    [event]
        name=sighted
        [filter]
            side=2
            id=The Houndkeeper
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        
        [scroll_to_unit]
            id=The Houndkeeper
        [/scroll_to_unit]
        
        [message]
            speaker=second_unit
            message= _ "Enemy ahead!"
        [/message]
        
        [message]
            speaker=The Houndkeeper
            message= _ "Enjoying my pets? Those hellhounds haven't been fed in over a week! They're starving - which means they'll eat absolutely anything!"
        [/message]
        
        [message]
            speaker=Devanar
            message= _ "You're responsible for this? How can you find such carnage entertaining?! Those... <i>Things</i> are ripping my soldiers limb from limb!"
        [/message]
        
        [message]
            speaker=The Houndkeeper
            message= _ "Hehe... That's the <i>fun</i> of it, isn't it? The atrocity? It's fascinating."
        [/message]
        
        [message]
            speaker=Devanar
            message= _ "You... You <i>twisted monster</i>! In the name of Parandel, I shall smite you where you stand!"
        [/message]
        
        [message]
            speaker=The Houndkeeper
            message= _ "Ha! Come here and try. This must be your first war, green boy, if you're incited to make proclamations by this skirmish alone."
        [/message]
        
        
        [message]
            role=Navigator
            message= _ "My lords, I don't think we can outrun them forever, especially with foes ahead of us in addition to those behind. We might be able to make a stand in this flooded fort."
        [/message]
        
        [message]
            speaker=Mal Idyr
            message= _ "Devanar, I appreciate the fervor, but given that there are likely imps before us, and hellhounds behind us, perhaps making a stand in these ruins is our best option, for the time being. First, though, we'll need to capture that keep."
        [/message]
        
        [message]
            speaker=Devanar
            message= _ "I can see to that."
        [/message]
        
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Devanar cradled the Rod in his hands, hastily whispering a few words into its gold, silver, and pearl. The Rod of Justice pulsed, and Devanar's veins glowed silver for a few moments. Seemingly at his behest, one of the keep's watchtowers crumbled and broke off, crushing the Houndkeeper that guarded the river pass."
        [/message]
        
        [sound]
            name=club.ogg
        [/sound]
        
        [harm_unit]
            [filter]
                id=The Houndkeeper
            [/filter]
            alignment=chaotic
            kill=yes
            amount=100
            animate=yes
        [/harm_unit]
        
        [message]
            role=Navigator
            message= _ "Hmm. Justice done."
        [/message]
        
        [message]
            speaker=Mal Idyr
            message= _ "It seems you're learning to communicate with the Rod, Devanar."
        [/message]
        
        [message]
            speaker=Devanar
            message= _ "Aye, I can convince it to grant us a few favors on the occasion that it cooperates. But let us not speak of it now! To the fort!"
        [/message]
        
        [objectives]
            side=1
            [objective]
                description= _ "Reach the sunken fort, then head northwest further into Krextin"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Devanar"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Mal Idyr"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Raourshin Ohn"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
        [/objectives]
        
        
    [/event]
    
    [event]
        name=die
        first_time_only=no
        [filter]
            type=Hellhound
            side=2
        [/filter]
        [set_variable]
            name=slainhound
            add=1
        [/set_variable]
        [if]
            [variable]
                name=slainhound
                greater_than=23
            [/variable]
            [then]
                
                [delay]
                    time=500
                [/delay]
                
                [message]
                    speaker=Devanar
                    message= _ "That's the last of them."
                [/message]

            [/then]
            [else]
            [/else]
        [/if]
    [/event]
    
    [event]
        name=die
        first_time_only=no
        [filter]
            type=Minor Imp,Imp,Blood Imp
            side=2
        [/filter]
        [set_variable]
            name=killedimp
            add=1
        [/set_variable]
        [if]
            [variable]
                name=killedimp
                numerical_equals=13
            [/variable]
            [then]
                
                [delay]
                    time=500
                [/delay]
                
                
                [message]
                    speaker=Devanar
                    message= _ "Great Gods, can this get any worse?!"
                [/message]
                
                [message]
                    speaker=Raourshin Ohn
                    message= _ "Be careful of what you speak into existence, mage!"
                [/message]
                
                {INCIDENTAL_MUSIC "silence.ogg"}
                
                [scroll_to]
                    x=55
                    y=21
                [/scroll_to]
                
                [sound]
                    name=fuse.ogg
                [/sound]
                
                [delay]
                    time=2000
                [/delay]
                
                [color_adjust]
                    red,green,blue=500,500,500
                [/color_adjust]
                
                [sound]
                    name=gun-energy-huge-fire-prelude.ogg
                [/sound]
                
                [delay]
                    time=2000
                [/delay]
                
                {QUAKE bot-huge-explosion.ogg}
                
                [sound]
                    name=explosion.ogg
                [/sound]
                
                [sound]
                    name=dwarf-laugh.wav
                [/sound]
                
                [unit]
                    id="Mal Sothar"
                    name= _ "Mal Sothar"
                    type=Necromancer
                    [modifications]
                        {TRAIT_SLOW}
                        {TRAIT_RESILIENT}
                    [/modifications]
                    upkeep=free
                    gender=male
                    unrenameable=yes
                    canrecruit=no
                    side=2
                    x=55
                    y=21
                    facing=sw
                    animate=no
                [/unit]
                
                {LOYAL_UNIT 2 (Shaxthal Sentry Drone) 54 20} {FACING sw}
                {LOYAL_UNIT 2 (Shaxthal Sentry Drone) 56 21} {FACING sw}
                
                {LOYAL_UNDEAD_UNIT 2 Ghoul 52 21} {FACING sw}
                {LOYAL_UNDEAD_UNIT 2 Ghoul 54 22} {FACING sw}
                
                {LOYAL_UNDEAD_UNIT 2 Soulless 54 19} {VARIATION saurian} {FACING sw}
                {LOYAL_UNDEAD_UNIT 2 Soulless 56 19} {VARIATION saurian} {FACING sw}
                {LOYAL_UNDEAD_UNIT 2 Soulless 58 20} {VARIATION saurian} {FACING sw}
                
                {MODIFY_TERRAIN Ur (51) (22)}
                {MODIFY_TERRAIN Ur (52) (22)}
                {MODIFY_TERRAIN Ur (53) (23)}
                {MODIFY_TERRAIN Ur (54) (23)}
                
                [remove_shroud]
                    side=1
                    x=51-58
                    y=18-23
                [/remove_shroud]
                
                [redraw]
                [/redraw]
                
                [color_adjust]
                    red,green,blue=0,0,0
                [/color_adjust]
                
                {INCIDENTAL_MUSIC "In_the_Land_of_Madness.ogg"}
                
                [message]
                    speaker=Mal Sothar
                    message= _ "Hehehe, prepare to die, unbelievers! Capture the boy for Lady Kindra, then slay the rest!"
                [/message]
                
                [message]
                    speaker=Mal Idyr
                    message= _ "..."
                [/message]
                
                [message]
                    speaker=Mal Idyr
                    message= _ "<i>Devanar</i>..."
                [/message]
                
                [message]
                    speaker=Devanar
                    message= _ "What?! This is not my fault, Mal Idyr! I did <i>not</i> jinx this!"
                [/message]
                
                
            [/then]
            [else]
            [/else]
        [/if]
    [/event]
    
    
    [event]
        name=moveto
        [filter]
            side=1
            x,y=53,20
        [/filter]
        [if]
            [variable]
                name=got_aetheodd_spear
                boolean_equals=no
            [/variable]
            [then]
                
                [message]
                    speaker=unit
                    message= _ "It seems that necromancer left something behind in this chamber..."
                [/message]
                
                [message]
                    speaker=Mal Idyr
                    message= _ "Dark Gods, is that... Let me look at that more closely."
                [/message]
                
                [delay]
                    time=2000
                [/delay]
                
                [message]
                    speaker=Mal Idyr
                    message= _ "I daresay that's Aetheodd's spear."
                [/message]
                
                [message]
                    speaker=Devanar
                    message= _ "Aetheodd? Of the Convocation?"
                [/message]
                
                [message]
                    speaker=Mal Idyr
                    message= _ "Aye, this was his signature weapon. I'd recognize it anywhere, though it seems a disgrace for it to be discarded in such abominable surroundings. Heh. Regardless, it will do us no good left here to decay, or for the forces of chaos to make use of. If any of the Aragwaithi among us are comfortable using it, I reckon it ought to go to one of them."
                [/message]
                
            [/then]
        [/if]
    [/event]
    
	#Spear of Aetheodd Esari
	[event]
		name=moveto
		first_time_only=no
		id=aetheodd_spear
        [filter]
            side=1
            race=aragwaith
            x,y=53,20
        [/filter]
		[if]
			[have_unit]
				x,y=53,20
			[/have_unit]
			[then]
				[item_dialog]
					name,image= _ "Spear of Aetheodd Esari",attacks/glaive.png
					description,effect= _ "Once wielded by Lord Aetheodd Esari of the Convocation, one of Parandel's most legendary generals, this spear has been enchanted by the Order of the Holy Flame. Not only does it make the bearer's strikes stronger and more accurate, but it also makes them less vulnerable to fire-based attacks. Choose wisely, brave hero. This sacred item should go to your most elite Aragwaith warrior.",{INTERNAL:SPECIAL_NOTES_AETHEODD_ESARI_SPEAR}
					take_string=_"Take it"
					leave_string=_"Leave it"
				[/item_dialog]
					[if]
						[variable]
							name=item_picked
							equals=yes
						[/variable]
						[then]
							[remove_event]
								id=aetheodd_spear
							[/remove_event]
							{TRoJ_AETHEODD_ESARI_SPEAR x,y=53,20 aetheodd_spear}
                            [message]
                                speaker=Devanar
                                message= _ "Wield that spear proudly, $unit.name|. I have no doubt that you will honor the late Lord Aetheodd's memory with it in battle well."
                            [/message]
                            
                            [message]
                                speaker=unit
                                message= _ "Certainly, my lord."
                            [/message]
							{VARIABLE got_aetheodd_spear yes}
						[/then]
					[/if]
			[/then]
		[/if]
	[/event]
		
    [event]
        name=sighted
        [filter]
            side=2
            id=Champion
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        
        [message]
            speaker=Champion
            message= _ "So you survived the hounds. Hmph. Charming. I suppose I'll mop up what's left of your "rescue squad," now."
        [/message]
        
        [message]
            speaker=Raourshin Ohn
            message= _ "Can you crush him again, mage?"
        [/message]
        
        [message]
            speaker=Devanar
            message= _ "I can try!"
        [/message]
        
        [delay]
            time=2000
        [/delay]
        
        [message]
            speaker=Champion
            message= _ "Ha! Don't strain yourself attempting to harness the Rod's power, amateur."
        [/message]
        
        [message]
            speaker=Devanar
            message= _ "I... I can't activate it again. I'm not sure why. I'm still getting used to its pathways and conduits. I've never handled a magical item like this before - it's far different in comparison to a staff or an astral blade."
        [/message]
        
        [message]
            speaker=Mal Idyr
            message= _ "Never fear - we'll just have to finish him off the usual way."
        [/message]
        
        
    [/event]

    [event]
        name=sighted
        [filter]
            id=Rofocas
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        
        [message]
            speaker=unit
            message= _ "It's them! Caimo, go inform Lord Edangor that the bearers of the Rod of Justice survived the hellhound ambush!"
        [/message]
        
        [message]
            speaker=second_unit
            message= _ "So much for infiltration and subtlety..."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            x=1
            y=1
            id=Mal Idyr, Devanar
        [/filter]
        [message]
            speaker=unit
            message= _ "Let us proceed forward with caution. If this was our 'welcoming,' then I fear for what Erya and Edangor have planned for us next."
        [/message]
        [endlevel]
            result=victory
            bonus=no
            {NEW_GOLD_CARRYOVER 0}
        [/endlevel]
    [/event]

[/scenario]
