#textdomain wesnoth-The_Rod_of_Justice

[scenario]
    id="19_Belly_of_the_Beast"
    name= _ "Belly of the Beast"
    map_data="{~add-ons/The_Rod_of_Justice/maps/19_Belly_of_the_Beast.map}"
    next_scenario="20_Chamilix"
    
    victory_when_enemies_defeated=no
    
    {UNDERGROUND}
    {SCENARIO_MUSIC "dungeon.ogg"}
    turns=-1
    
    {ROD_DEATH}
    
    
    [side]
        type=Silver Lord
        id=Devanar
        name= _ "Devanar"
        unrenamable=yes
        profile=portraits/devanar.png
        side=1
        canrecruit=yes
        team_name=good
        user_team_name=_"New Elensia"
        controller=human
        {GOLD 0 0 0}
        {INCOME 0 0 0}
        {FLAG_VARIANT long}
    [/side]
    
    
    [side]
        side=2
        color=black
        team_name="bad"
        user_team_name= _ "Edangor"
        {FLAG_VARIANT ragged}
        no_leader=yes
        {GOLD 75 100 150}
        {INCOME 0 0 0}
        hidden=yes
        controller=ai
        
        [unit]
            id=Meiara
            name= _ "Meiara"
            unrenameable=yes
            upkeep=free
            type="Vampire Lady"
            canrecruit=yes
            extra_recruit="Blood Bat, Giant Mudcrawler"
            x=11
            y=8
            facing=se
        [/unit]
        
        [unit]
            id=Aetheodd
            name= _ "Aetheodd"
            unrenameable=yes
            upkeep=free
            type="Death Knight"
            canrecruit=yes
            extra_recruit="Soulless"
            x=15
            y=8
            facing=se
        [/unit]
        
        [ai]
            time_of_day=underground
            aggression=0.99
            caution=0.01
        [/ai]
        
    [/side]
    
    
    [event]
        name=prestart
        
        {GENERIC_UNIT 2 (Giant Mudcrawler) 2 14}
        {GENERIC_UNIT 2 (Giant Mudcrawler) 6 10}
        {GENERIC_UNIT 2 (Giant Mudcrawler) 23 11}
        {GENERIC_UNIT 2 (Mudcrawler) 6 15}
        {GENERIC_UNIT 2 (Mudcrawler) 20 15}
        {GENERIC_UNIT 2 (Mudcrawler) 23 14}
        {GENERIC_UNIT 2 (Ghoul) 21 8} {FACING sw}
        {GENERIC_UNIT 2 (Ghoul) 5 9} {FACING se}
        
        {LOYAL_UNIT 2 Soulless 3 12} {VARIATION swimmer} {FACING ne}
        {LOYAL_UNIT 2 Soulless 20 12} {VARIATION swimmer} {FACING nw}
        
        [recall]
            id="Raourshin Ohn"
            x=13
            y=12
        [/recall]
        
        [recall]
            id="Mal Idyr"
            x=12
            y=11
        [/recall]
        
        [recall]
            id="Mergubraesh"
            x=13
            y=13
        [/recall]
        
        [recall]
            id="Arthyn"
            x=9
            y=11
        [/recall]
        
        [recall]
            id="Afiriah"
            x=17
            y=11
        [/recall]
        
        [recall]
            id="Kalassa"
            x=9
            y=13
        [/recall]
        
        [recall]
            id="Haradd"
            x=17
            y=13
        [/recall]
        
        [recall]
            id="Mercy"
            x=17
            y=15
        [/recall]
        
        [recall]
            id="Geonn"
            x=18
            y=14
        [/recall]
        
        [recall]
            id="Kronak"
            x=9
            y=15
        [/recall]
		
        [recall]
            id="Guard"
            x=10
            y=15
        [/recall]
		
        [store_unit]
            [filter]
                side=1
                canrecruit=no
                [not]
                    id=Mergubraesh
                [/not]
                [not]
                    id=Arthyn
                [/not]
                [not]
                    id=Afiriah
                [/not]
                [not]
                    id=Haradd
                [/not]
                [not]
                    id=Mercy
                [/not]
                [not]
                    id=Kronak
                [/not]
                [not]
                    id=Kalassa
                [/not]
                [not]
                    id=Raourshin Ohn
                [/not]
                [not]
                    id=Geonn
                [/not]
            [/filter]
            kill=yes
            variable=units
        [/store_unit]
		{VARIABLE units 0}
		[while]
			[variable]
			name=units
			less_than=$i.length
			[/variable]
			[do]
				[unstore_unit]
					variable=units[$i]
					find_vacant=yes
					x=13
					y=15
				[/unstore_unit]
				[set_variable]
					name=i
					add=1
				[/set_variable]
			[/do]
		[/while]
		{CLEAR_VARIABLE i}
        {CLEAR_VARIABLE units}
        
        
        [object]
            silent=yes
            duration=forever
            [filter]
                id=Meiara
            [/filter]
            [effect]
                apply_to=hitpoints
                increase=100
                increase_total=100
            [/effect]
            
            [effect]
                apply_to=attack
                range=melee
                increase_damage=3
            [/effect]
            [effect]
                apply_to=attack
                range=ranged
                increase_damage=3
            [/effect]
            
        [/object]
        
        [heal_unit]
            [filter]
                id=Meiara
            [/filter]
            amount=full
        [/heal_unit]
        
        [object]
            silent=yes
            duration=forever
            [filter]
                id=Aetheodd
            [/filter]
            [effect]
                apply_to=hitpoints
                increase=100
                increase_total=100
            [/effect]
        [/object]
        
        [heal_unit]
            [filter]
                id=Aetheodd
            [/filter]
            amount=full
        [/heal_unit]
        
        {FADE_TO_BLACK}
        
    [/event]
    
    [event]
        name=start
        
        #define RESTORE_RECALL_LIST
		{VARIABLE recall_list 0}
		[while]
			[variable]
			name=recall_list
			less_than=$i.length
			[/variable]
			[do]
				[unstore_unit]
					variable=recall_list[$i]
				[/unstore_unit]
				[set_variable]
					name=i
					add=1
				[/set_variable]
			[/do]
		[/while]
		{CLEAR_VARIABLE i}
        {CLEAR_VARIABLE recall_list}
        #enddef
        
        [delay]
            time=1000
        [/delay]
        
        {FADE_IN}
        
        [message]
            speaker="Devanar"
            message= _ "These ruins barely resemble the Krextin I knew... Lady Meiara's garden is utterly wilted, and the imps seemed to have corrupted and desecrated this chamber to be more to their liking."
        [/message]
        
        [message]
            speaker="Mal Idyr"
            message= _ "Pah... And to think, that I spent so long planning the architecture of this keep, only for it to be wreathed in filth."
        [/message]
        
        [message]
            speaker="Aetheodd"
            message= _ "Nephew..."
        [/message]
        
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Devanar looked ahead at the skeleton that stood before him, frozen partly in fear, and partly in shock."
        [/message]
        
        [message]
            speaker="Devanar"
            message= _ "Did that skeleton say-"
        [/message]
        
        [message]
            speaker="Aetheodd"
            message= _ "Nephew..."
        [/message]
        
        [message]
            speaker="Mal Idyr"
            message= _ "I daresay... His armor..."
        [/message]
        
        [delay]
            time=2000
        [/delay]
        
        [message]
            speaker="Mal Idyr"
            message= _ "That's Aetheodd and Meiara."
        [/message]
        
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The death knight strained to say a few more words, but the poor creature froze and began to rattle. The remnants of Aetheodd's body contorted, his jaw unhinging as orbs of red light pulsed from where his eye sockets once were."
        [/message]
        
        [sound]
            name=dragon-speak-long.ogg
        [/sound]
        
        [message]
            speaker="Aetheodd"
            message= _ "Do you see what your resistance has wrought, sorcerers? Even the strongest among you can only hope to be fodder for Erya's hunger for strength and power."
        [/message]
        
        [message]
            speaker="Devanar"
            message= _ "Great Gods, is nothing sacred to Erya and you lot?!"
        [/message]
        
        [sound]
            name=dragon-speak-long.ogg
        [/sound]
        
        [message]
            speaker="Aetheodd"
            message= _ "Aye, power is. Regardless, how is this any different from Elantos and Elidyr's resurrection of your slain foes? You decry the so-called cruelty of your opponents, yet implement the same practices and name them justice."
        [/message]
        
        [message]
            speaker="Mal Idyr"
            message= _ "I have never sullied a spirit, or tortured a soul like this!"
        [/message]
        
        [sound]
            name=dragon-speak-long.ogg
        [/sound]
        
        [message]
            speaker="Aetheodd"
            message= _ "No? You've never resurrected the commanders of your enemies to serve you again, in death? Not bandits, or even paladins? You have never tortured an enemy, say, even an imp, for information? Never pulled his soul from his body and electrified him with the most brutal of cold magics to extract information? You've never conquered another people for the survival or betterment of your own? Not even rival saurians?"
        [/message]
        
        [message]
            speaker="Mal Idyr"
            message= _ "You bumbling demon, I-"
        [/message]
        
        [sound]
            name=dragon-roar.ogg
        [/sound]
        
        [delay]
            time=500
        [/delay]
        
        [message]
            speaker="Aetheodd"
            message= _ "<span color='red' size='xx-large' weight='heavy'><b>SILENCE.</b></span>"
        [/message]
        
        [sound]
            name=dragon-speak-long.ogg
        [/sound]
        
        [message]
            speaker="Aetheodd"
            message= _ "Danica's journals have been <i>most</i> useful in gaining insight to what kind of leader you are, Elidyr. I am grateful to Lunoskelchia for recovering them from the south. They provide some consolation and ease of mind for putting your people to the sword and toppling your cities, knowing that you did the same to others centuries ago."
        [/message]
        
        [sound]
            name=dragon-speak-short.ogg
        [/sound]
        
        [message]
            speaker="Aetheodd"
            message= _ "But of course, you're not here to discuss war politics and morality. You're here to die."
        [/message]
        
        [sound]
            name=dragon-speak-long.ogg
        [/sound]
        
        [message]
            speaker="Aetheodd"
            message= _ "Devanar, if you lay down the Rod of Justice, relinquish the Soul Jewel of Tirasz, and allow Elidyr and his undead minions to be purged from Irdya, then you and your soldiers may live to serve the Chaos Empire. Although a position alongside one of the chaos generals is not a wholly safe or desirable one, it is a far kinder fate than what I originally intended for you."
        [/message]
        
        [message]
            speaker="Devanar"
            message= _ "I will never betray my people, Edangor, so long as I draw breath."
        [/message]
        
        [sound]
            name=dragon-speak-long.ogg
        [/sound]
        
        [message]
            speaker="Aetheodd"
            message= _ "Hmm. The youth are ever so dramatic, yet so admirably convicted in their causes, aren't they Elidyr? Make no mistake, Devanar. I would, and perhaps will, delight in wrenching the Rod from your unworthy hands. But it seems you have friends, even within the Chaos Empire, who would see you given <i>yet another</i> chance. So I shall offer you mercy a second, and final time."
        [/message]
        
        [message]
            speaker="Devanar"
            message= _ "And my answer shall remain the same."
        [/message]
        
        [sound]
            name=dragon-speak-short.ogg
        [/sound]
        
        [message]
            speaker="Aetheodd"
            message= _ "Very well then. I suppose I should have expected nothing less from Kindra's son."
        [/message]
        
        [sound]
            name=dragon-speak-short.ogg
        [/sound]
        
        [message]
            speaker="Aetheodd"
            message= _ "I will do my best to grant you a quick death, Devanar."
        [/message]
        
        [objectives]
            side=1
            [objective]
                description= _ "Defeat Aetheodd and Meiara"
                condition="win"
            [/objective]
            [objective]
                description= _ "Death of Devanar"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Mal Idyr"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Raourshin Ohn"
                condition="lose"
            [/objective]
        [/objectives]
        
        
    [/event]
    
    
    [event]
        name=die
        first_time_only=no
		id=phase1
        [filter]
            type=Vampire Lady, Death Knight
            side=2
        [/filter]
        [set_variable]
            name=minibossdefeated
            add=1
        [/set_variable]
        [if]
            [variable]
                name=minibossdefeated
                greater_than=1
            [/variable]
            [then]
                
                [delay]
                    time=500
                [/delay]
                
                {QUAKE "rumble.ogg"}
                
                
                [set_variable]
                    name=bosslevel
                    add=1
                [/set_variable]
                
                [sound]
                    name=dragon-speak-short.ogg
                [/sound]
                
                [message]
                    speaker=narrator
                    image="wesnoth-icon.png"
                    message= _ "So you wish to meet slow ends? Very well. That can be accommodated."
                [/message]
                
                {QUAKE "rumble.ogg"}
                
                {SCATTER_UNITS 15 "Imp, Giant Cockroach" 1 (
                terrain=Uu^Uf, Uu, Uh
                x=2-23
                y=2-7
                
                [not]
                    [filter]
                    [/filter]
                [/not]
                
                [not]
                    [filter_adjacent_location]
                        [filter]
                        [/filter]
                    [/filter_adjacent_location]
                [/not]
                ) (
                side=2
                generate_name=yes
                random_traits=yes
                
                [modifications]
                    {TRAIT_LOYAL}
                [/modifications]
                )}
                
                
                [objectives]
                    side=1
                    [objective]
                        description= _ "Defeat Demon Lord Edangor's minions"
                        condition="win"
                    [/objective]
                    [objective]
                        description= _ "Death of Devanar"
                        condition="lose"
                    [/objective]
                    [objective]
                        description= _ "Death of Mal Idyr"
                        condition="lose"
                    [/objective]
                    [objective]
                        description= _ "Death of Raourshin Ohn"
                        condition="lose"
                    [/objective]
                [/objectives]
                [remove_event]
					id=phase1
				[/remove_event]
            [/then]
            [else]
            [/else]
        [/if]
    [/event]
    
    
    [event]
        name=die
        first_time_only=no
		id=phase2
        [filter]
            type=Imp, Giant Cockroach
            side=2
        [/filter]
        [set_variable]
            name=minionclassadefeated
            add=1
        [/set_variable]
        [if]
            [variable]
                name=minionclassadefeated
                greater_than=14
            [/variable]
            [then]
                
                [delay]
                    time=500
                [/delay]
                
                {QUAKE "rumble.ogg"}
                
                {QUAKE "rumble.ogg"}
                
                
                [set_variable]
                    name=bosslevel
                    add=1
                [/set_variable]
                
                [message]
                    speaker=narrator
                    image="wesnoth-icon.png"
                    message= _ "The ground trembled, as if a great, lumbering beast was approaching."
                [/message]
                
                {QUAKE "rumble.ogg"}
                
                {SCATTER_UNITS 13 "Blood Imp, Necrophage" 1 (
                terrain=Uu^Uf, Uu, Uh
                x=2-23
                y=2-7
                
                [not]
                    [filter]
                    [/filter]
                [/not]
                
                [not]
                    [filter_adjacent_location]
                        [filter]
                        [/filter]
                    [/filter_adjacent_location]
                [/not]
                ) (
                side=2
                generate_name=yes
                random_traits=yes
                
                [modifications]
                    {TRAIT_LOYAL}
                [/modifications]
                )}
                
                [message]
                    speaker="Raourshin Ohn"
                    message= _ "I fear a lengthy conflict lies ahead."
                [/message]
                
                [message]
                    speaker="Mal Idyr"
                    message= _ "Indeed. Devanar, do you recall that free-for-all Vikren embroiled us in, before we were led to the Trial Chamber? How fresh water and young forests seemed to recover and burst forth in the presence of the Rod's magic?"
                [/message]
                
                [message]
                    speaker="Devanar"
                    message= _ "Yes?"
                [/message]
                
                [message]
                    speaker="Mal Idyr"
                    message= _ "Try honing in on the core of the Rod, and then speak to the garden... Something may happen yet."
                [/message]
                
                [message]
                    speaker="Devanar"
                    message= _ "Wellspring of life, hark! Purify this toxic earth!"
                [/message]
                
                {MODIFY_TERRAIN Dd^Do (9) (11)}
                {MODIFY_TERRAIN Dd^Do (9) (13)}
                
                {MODIFY_TERRAIN Dd^Do (17) (11)}
                {MODIFY_TERRAIN Dd^Do (17) (13)}
                
                [redraw][/redraw]
                    
				[sound]
					name=heal.wav
				[/sound]
				
				[sound]
					name=entangle.wav
				[/sound]
				
				[message]
					speaker="Mal Idyr"
					message= _ "Meiara, you clever witch! Now that we've restored part of the garden, we may be able to recoup before Edangor sends his next wave of minions."
				[/message]
                    
                [remove_event]
					id=phase2
				[/remove_event]
				
			[/then]
			[else]
			[/else]
		[/if]
	[/event]
        
        
        [event]
            name=die
            first_time_only=no
			id=phase3
            [filter]
                type=Blood Imp, Necrophage
                side=2
            [/filter]
            [set_variable]
                name=minionclassbdefeated
                add=1
            [/set_variable]
            [if]
                [variable]
                    name=minionclassbdefeated
                    greater_than=11
                [/variable]
                [then]
                    
                    [delay]
                        time=500
                    [/delay]
                    
                    {QUAKE "rumble.ogg"}
                    
                    
                    [set_variable]
                        name=bosslevel
                        add=1
                    [/set_variable]
                    
                    
                    [unit]
                        id="Caimo"
                        name= _ "Caimo, the Voice of Demon Lord Edangor"
                        type=Gutwrencher Imp
                        [modifications]
                            {TRAIT_LOYAL}
                        [/modifications]
                        {IS_LOYAL}
                        unrenameable=yes
                        canrecruit=no
                        side=2
                        x=13
                        y=2
                        facing=sw
                        animate=no
                    [/unit]
                    
                    [object]
                        silent=yes
                        duration=forever
                        [filter]
                            id=Caimo
                        [/filter]
                        [effect]
                            apply_to=hitpoints
                            increase=20
                            increase_total=20
                        [/effect]
                    [/object]
                    
                    {SCATTER_UNITS 6 "Gutwrencher Imp" 1 (
                    terrain=Uu^Uf, Uu, Uh
                    x=2-23
                    y=2-7
                    
                    [not]
                        [filter]
                        [/filter]
                    [/not]
                    
                    [not]
                        [filter_adjacent_location]
                            [filter]
                            [/filter]
                        [/filter_adjacent_location]
                    [/not]
                    ) (
                    side=2
                    generate_name=yes
                    random_traits=yes
                    
                    [modifications]
                        {TRAIT_LOYAL}
                    [/modifications]
                    )}
                    
                    
                    [sound]
                        name=dragon-speak-short.ogg
                    [/sound]
                    
                    [message]
                        speaker="Caimo"
                        message= _ "This could have ended much differently, Devanar."
                    [/message]
                    
                    [message]
                        speaker="Devanar"
                        message= _ "Come face us, Edangor! Or do you fear the power of the Rod?"
                    [/message]
                    
                    [sound]
                        name=dragon-speak-short.ogg
                    [/sound]
                    
                    [message]
                        speaker="Caimo"
                        message= _ "Haha! Be careful of what you wish for, fool boy."
                    [/message]
                    
					[remove_event]
						id=phase3
					[/remove_event]
				
                [/then]
                [else]
                [/else]
            [/if]
        [/event]
        
        
        [event]
            name=die
            first_time_only=no
			id=phase4
            [filter]
                type=Gutwrencher Imp
                side=2
            [/filter]
            [set_variable]
                name=minionclasscdefeated
                add=1
            [/set_variable]
            [if]
                [variable]
                    name=minionclasscdefeated
                    greater_than=6
                [/variable]
                [then]
                    
                    [delay]
                        time=500
                    [/delay]
                    
                    {QUAKE "rumble.ogg"}
                    
                    {REPLACE_SCENARIO_MUSIC "Silence.ogg"}
                    
                    [delay]
                        time=1000
                    [/delay]
                    
                    [message]
                        speaker=narrator
                        image="wesnoth-icon.png"
                        message= _ "As the last gutwrencher imp fell, an eerie silence pervaded the devastated throne room. Devanar and his soldiers held their breath, the heaving, quaking impacts of an unknown creature approaching them."
                    [/message]
                    
                    [message]
                        speaker="Devanar"
                        message= _ "Brace yourselves!"
                    [/message]
                    
                    {QUAKE "rumble.ogg"}
                    
                    [delay]
                        time=2000
                    [/delay]
                    
                    {QUAKE "rumble.ogg"}
                    
                    [delay]
                        time=1000
                    [/delay]
                    
                    {QUAKE "rumble.ogg"}
                    
                    [delay]
                        time=500
                    [/delay]
                    
                    {QUAKE "rumble.ogg"}
                    {QUAKE "rumble.ogg"}
                    
                    
                    {REPLACE_SCENARIO_MUSIC "Overlive.ogg"}
                    
                    {LOYAL_UNIT 2 (Ghast) 11 3}
                    {LOYAL_UNIT 2 (Ghast) 15 3}
                    
                    [unit]
                        {CHARACTER_STATS_EDANGOR}
                        side=2
                        x=13
                        y=2
                        animate=yes
                    [/unit]
                    
                    [object]
                        silent=yes
                        duration=forever
                        [filter]
                            id=Edangor
                        [/filter]
                        
                        
                        [effect]
                            apply_to=hitpoints
                            increase=140
                            increase_total=140
                        [/effect]
                        
                        
                        [effect]
                            apply_to=new_attack
                            name=acrid breath
                            description= _ "acrid breath"
                            type=fire
                            [specials]
                                {WEAPON_SPECIAL_POISON}
                            [/specials]
                            range=ranged
                            damage=7
                            number=3
                            icon=attacks/fire-breath-drake.png
                        [/effect]
                        
                        [effect]
                            apply_to=new_animation
                            [attack_anim]
                                [filter_attack]
                                    name=acrid breath
                                [/filter_attack]
                                {MISSILE_FRAME_FIRE_BREATH 8,-60 8,40 35,-30 35,30}
                                start_time=-600
                                [frame]
                                    image="units/imps/imp-armageddon.png:300"
                                [/frame]
                                {SOUND:HIT_AND_MISS flame-big.ogg flame-big-miss.ogg -300}
                            [/attack_anim]
                            
                            
                        [/effect]
                        
                    [/object]
                    
                    
                    
                    
                    [set_variable]
                        name=bosslevel
                        add=1
                    [/set_variable]
                    
                    
                    [sound]
                        name=dragon-speak-long.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "I do admit, I did not fully expect you to survive up to this point, yet here you stand. You have defeated hellhounds, imps, necrophages, and even my champion. If I didn't despise your very existence, I might consider congratulating your prowess."
                    [/message]
                    
                    [message]
                        speaker="Devanar"
                        message= _ "You're even more grotesque than I had anticipated you would be, imp."
                    [/message]
                    
                    [sound]
                        name=dragon-speak-short.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "Ha! And you have proven far more green, brash, and naive than we had anticipated, so let's chalk it up to a time of pleasant surprises, hmm?"
                    [/message]
                    
                    [message]
                        speaker="Devanar"
                        message= _ "I will ask but once: where is Adria?"
                    [/message]
                    
                    [sound]
                        name=dragon-speak-short.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "Adria? That shadowborn faerie you travelled with? I rather liked her. At least <i>she</i> was not partial to violent hypocrisy."
                    [/message]
                    
                    [message]
                        speaker="Devanar"
                        message= _ "That was not an answer."
                    [/message]
                    
                    [sound]
                        name=dragon-speak-short.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "Oh! So bold, you are! Shall I tell you, Devanar? Shall I? Would that just <i>mend</i> your little heart?"
                    [/message]
                    
                    [sound]
                        name=dragon-speak-long.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "I have no knowledge of what happened to Adria. If she's lucky, then Erya will have already gutted her at Tiraszshold and drained her powers - if not, then she'll be left for the lorekeepers to play with. Regardless, she is not here. You walked, nay, ran right into our trap with full abandon - sprinting to Krextin while Adria resided in the opposite direction. "
                    [/message]
                    
                    [sound]
                        name=dragon-speak-long.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "Tell me, Devanar, how has it felt to pander after the life of one faerie while thousands die due to your negligence? Although, perhaps they are better off slain now. Should Erya tarry too long, I imagine the fate of your people will be more akin to genocide than vassal fealty."
                    [/message]
                    
                    [message]
                        speaker="Devanar"
                        message= _ "Tarry too long? What are you implying?"
                    [/message]
                    
                    [sound]
                        name=dragon-speak-long.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "Hmm. Maybe, after I've slain every last one of your countrymen, and saved you for last, I shall whisper the impending fate of your people into your ear. How does that sound, Devanar?"
                    [/message]
                    
                    
                    [harm_unit]
                        [filter]
                            id=Edangor
                        [/filter]
                        [filter_second]
                            id=Devanar
                        [/filter_second]
                        [primary_attack]
                            range=ranged
                        [/primary_attack]
                        [secondary_attack]
                            range=ranged
                        [/secondary_attack]
                        amount=40
                        kill=no
                        animate=yes
                    [/harm_unit]
                    
                    [delay]
                        time=500
                    [/delay]
                    
                    [message]
                        speaker="Devanar"
                        message= _ "Answer me!"
                    [/message]
                    
                    [sound]
                        name=dragon-speak-short.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "The smart of the power within that Rod... It stings like no other. I am a bit shocked you are able to wield it. Nevertheless..."
                    [/message]
                    
                    [heal_unit]
                        [filter]
                            id=Edangor
                        [/filter]
                        amount=full
                    [/heal_unit]
                    
                    [sound]
                        name=heal.wav
                    [/sound]
                    
                    [sound]
                        name=poison.ogg
                    [/sound]
                    
                    [delay]
                        time=500
                    [/delay]
                    
                    [sound]
                        name=dragon-speak-short.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "I have made provisions for that weapon. And the juvenile rage of its bearer."
                    [/message]
                    
                    [sound]
                        name=dragon-speak-long.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "Erya's greatest weakness was, and is, an underestimation of your abilities. She is a wrathful, vainglorious fool whose incompetence in managing this assault is matched only by her arrogance. When she heard that Parandel had sent a lich, a faerie, and a young mage to recover the Rod, she assumed she would make quick work of you. And here I stand, months later, cleaning up her <i>mess.</i>"
                    [/message]
                    
                    [message]
                        speaker="Mal Idyr"
                        message= _ "Allow me, Devanar! My brother and I helped design and build parts this castle. This is my land. And I shall push Edangor from it just as I banished Erya from the battlefield as we left Parandel."
                    [/message]
                    
                    [harm_unit]
                        [filter]
                            id=Edangor
                        [/filter]
                        [filter_second]
                            id=Mal Idyr
                        [/filter_second]
                        [primary_attack]
                            range=ranged
                        [/primary_attack]
                        [secondary_attack]
                            range=ranged
                        [/secondary_attack]
                        amount=40
                        kill=no
                        animate=yes
                    [/harm_unit]
                    
                    [delay]
                        time=500
                    [/delay]
                    
                    [sound]
                        name=dragon-speak-long.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "Your Soul Jewel is impressive, necromancer. Perhaps just as, if not more dangerous than the Rod, considering how you're much more familiar with and attuned to its powers. Still. I have predicted this too. Unlike Erya, I put thought into clipping my loose ends before they unravel and become the problems of others."
                    [/message]
                    
                    [heal_unit]
                        [filter]
                            id=Edangor
                        [/filter]
                        amount=full
                    [/heal_unit]
                    
                    [sound]
                        name=heal.wav
                    [/sound]
                    
                    [sound]
                        name=poison.ogg
                    [/sound]
                    
                    [message]
                        speaker=narrator
                        image="wesnoth-icon.png"
                        message= _ "The poisonous rot of the room healed Edangor's wounds, the Rod of Justice's burns and the Soul Jewel's green shockwaves seemingly erased by the miasma surrounding the imp lord. Devanar and Mal Idyr balked as the demon grinned."
                    [/message]
                    
                    [sound]
                        name=dragon-speak-short.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "You once redirected the so-called poison of Erya's words upon her. Allow me to return the favor to your followers, lich."
                    [/message]
                    
                    [sound]
                        name=gun-energy-huge-fire-prelude.ogg
                    [/sound]
                    
                    {FLASH_GREEN ()}
                    
                    [delay]
                        time=250
                    [/delay]
                    
                    [sound]
                        name=poison.ogg
                    [/sound]
                    
                    [store_unit]
                        [filter]
                            side=1
                            [not]
                                race=undead
                            [/not]
                        [/filter]
                        variable=stored_units
                    [/store_unit]
                    
					{VARIABLE stored_units 0}
					[while]
						[variable]
						name=stored_units
						less_than=$i.length
						[/variable]
						[do]
                    
						{VARIABLE stored_units[$i].status.poisoned yes}
						
						[unstore_unit]
							variable=stored_units[$i]
						[/unstore_unit]
						[set_variable]
							name=i
							add=1
						[/set_variable]
						[/do]
					[/while]
					{CLEAR_VARIABLE i}
                    {CLEAR_VARIABLE stored_units}
                    
                    [sound]
                        name=lich-hit-1.ogg
                    [/sound]
                    
                    [message]
                        speaker="Mal Idyr"
                        message= _ "You insolent cur!"
                    [/message]
                    
                    [sound]
                        name=dragon-speak-short.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "Ha! How petulant. I expected nothing less from the son of a nobleman. Now. As amusing as this delay has been, it is time for it to cease."
                    [/message]
                    
                    [delay]
                        time=500
                    [/delay]
                    
                    [message]
                        speaker=narrator
                        image="wesnoth-icon.png"
                        message= _ "The towering imp lord began to chant in deep, cavernous tones. His words seemed to swell and trip out of his jaws, boiling and wailing in the air, like a rageful echo that refused to stop multiplying."
                    [/message]
                    
                    [delay]
                        time=500
                    [/delay]
                    
                    [sound]
                        name=dragon-speak-long.ogg
                    [/sound]
                    
                    [sound]
                        name=dragon-speak-short.ogg
                    [/sound]
                    
                    [message]
                        speaker=narrator
                        image="wesnoth-icon.png"
                        message= _ "His voice rose and fell, the words overlapping and burying each other, struggling like crabs in a barrel, as Devanar, Mal Idyr, Raourshin Ohn, and the others were paralyzed where they stood by the ensorcelling gravity of Edangor's words."
                    [/message]
                    
                    [delay]
                        time=1000
                    [/delay]
                    
                    [sound]
                        name=dragon-speak-long.ogg
                    [/sound]
                    
                    [sound]
                        name=dragon-speak-long.ogg
                    [/sound]
                    
                    [sound]
                        name=dragon-speak-short.ogg
                    [/sound]
                    
                    [delay]
                        time=1000
                    [/delay]
                    
                    [message]
                        speaker=narrator
                        image="wesnoth-icon.png"
                        message= _ "Finally, the chant reached a peak, and an ethereal, haunting mist began to seep through the walls."
                    [/message]
                    
                    {REPLACE_SCENARIO_MUSIC "silence.ogg"}
                    
                    [sound]
                        name=dragon-speak-short.ogg
                    [/sound]
                    
                    [message]
                        speaker="Edangor"
                        message= _ "Your bodies shall dissolve. Your souls shall wither. And I..."
                    [/message]
                    
                    [sound]
                        name=dragon-speak-short.ogg
                    [/sound]
                    
                    [delay]
                        time=2000
                    [/delay]
                    
                    {REPLACE_SCENARIO_MUSIC "BossBattle.ogg"}
                    
                    [message]
                        speaker="Edangor"
                        message= _ "<span color='red' size='xx-large' weight='heavy'><b>I shall feast on what remains.</b></span>   "
                    [/message]
                    
                    
                    [object]
                        name= _ "BATTLE VS! DEMON LORD EDANGOR"
                        image=portraits/bigimp.png
                        duration=forever
                        description= _ "<span color='brown' size='xx-large' weight='heavy'><b>Elemental Aspect - Darkness</b></span>
                        
Second only to, or perhaps even equal to Erya, Demon Lord Edangor rules over the band of imps besieging Parandel. In addition to his nearly unassailable vitality, he holds firm command over all that rots and festers, and as such, his knowledge of poisonous dark magic is virtually unparalleled. Up close, he can cleave enemies in half with his rancorous blade as he saps their life force, while at a distance, Edangor can pierce armor with oozing slime spit, or simultaneously melt and poison a foe with his putrefying breath. Perhaps most fearsome of all, he is also capable of summoning corrosive, venomous mist that eats away at living creatures. This ability to consume the bodies and souls of his enemies, often simultaneously, has given him an internal reservoir of highly virulent magical power. You'll need to strategically use any healers you have, and confront Edangor with FIRE, COLD or ARCANE attacks to prevail. Take care, brave hero. Great caution and deft tactics are required to defeat an Armageddon Imp of the Chaos Empire."
                        
                        
                        [filter]
                            id=Devanar
                        [/filter]
                        [effect]
                            apply_to=hitpoints
                            increase=0
                            increase_total=0
                        [/effect]
                    [/object]
                    
                    [message]
                        speaker="Mal Idyr"
                        message= _ "I fear we shan't last against the toxic veil encroaching upon us, Devanar."
                    [/message]
                    
                    [message]
                        speaker="Devanar"
                        message= _ "I think I can attempt to dispel it, but between the Rod's unreliability and the complexity of Edangor's spell, I'll need some time."
                    [/message]
                    
                    [message]
                        speaker="Raourhsin Ohn"
                        message= _ "Just don't take too long, augur. I can feel my inner fire dimming by the moment."
                    [/message]
                    
                    [objectives]
                        side=1
                        [objective]
                            description= _ "Defeat Demon Lord Edangor"
                            condition="win"
                        [/objective]
                        [objective]
                            description= _ "Death of Devanar"
                            condition="lose"
                        [/objective]
                        [objective]
                            description= _ "Death of Mal Idyr"
                            condition="lose"
                        [/objective]
                        [objective]
                            description= _ "Death of Raourshin Ohn"
                            condition="lose"
                        [/objective]
                    [/objectives]
					
					[remove_event]
						id=phase4
					[/remove_event]
				
                [/then]
                [else]
                [/else]
            [/if]
        [/event]
        
        
        
        [event]
            id=poison_fog
            
            name=side 1 turn
            first_time_only=no
            
            
            [if]
                [variable]
                    name=bosslevel
                    greater_than=3
                [/variable]
                [then]
                    
                    
                    [modify_side]
                        
                        side=1
                        fog=yes
                        
                    [/modify_side]
                    
                    [redraw]
                        side=1
                    [/redraw]
                    
                    [sound]
                        name=poison.ogg
                    [/sound]
                    
                    [store_unit]
                        [filter]
                            side=1
                            [not]
                                race=undead
                            [/not]
                        [/filter]
                        variable=stored_units
                    [/store_unit]
					{VARIABLE stored_units 0}
					[while]
						[variable]
						name=stored_units
						less_than=$i.length
						[/variable]
						[do]
                    
						{VARIABLE stored_units[$i].status.poisoned yes}
						
						[unstore_unit]
							variable=stored_units[$i]
						[/unstore_unit]
                    
						[set_variable]
							name=i
							add=1
						[/set_variable]
						[/do]
					[/while]
					{CLEAR_VARIABLE i}
                    {CLEAR_VARIABLE stored_units}
                    
                    [set_variable]
                        name=castingtime
                        add=1
                    [/set_variable]
                    
                [/then]
                [else]
                [/else]
            [/if]
        [/event]
        
        
        [event]
            id=fog_update
            
            name=side 1 turn
            first_time_only=no
            
            
            [if]
                [variable]
                    name=castingtime
                    numerical_equals=4
                [/variable]
                [then]
                    
                    [message]
                        speaker="Devanar"
                        message= _ "I've almost dispelled it - we only have to hold out but a little while longer!"
                    [/message]
                    
                [/then]
                [else]
                [/else]
            [/if]
        [/event]
        
        
        [event]
            id=fog_dispel
            
            name=side 1 turn
            first_time_only=no
            
            
            [if]
                [variable]
                    name=castingtime
                    greater_than=4
                [/variable]
                [then]
                    
                    
                    {CLEAR_VARIABLE bosslevel}
                    
                    [modify_side]
                        side=1
                        fog=no
                    [/modify_side]
                    
                    [sound]
                        name=magic-faeriefire-miss.ogg
                    [/sound]
                    
                    [message]
                        speaker="Devanar"
                        message= _ "There... Edangor's spell is still too strong for me to cure us all, but I've managed to block any more mist from entering the chamber."
                    [/message]
                    
                    [message]
                        speaker="Mal Idyr"
                        message= _ "Let us hope that your wards hold long enough for us to defeat him, Devanar."
                    [/message]
                    
                    {CLEAR_VARIABLE castingtime}
                    [remove_event]
						id=poison_fog
                    [/remove_event]
                [/then]
                [else]
                [/else]
            [/if]
        [/event]
        
        
        [event]
            name="last breath"
            [filter]
                id="Edangor"
            [/filter]
            
            [sound]
                name=dragon-roar.ogg
            [/sound]
            
            {REPLACE_SCENARIO_MUSIC "snowfall.ogg"}
            
            
            [message]
                speaker=narrator
                image="wesnoth-icon.png"
                message= _ "As the fatal blow hit Edangor, the imp wobbled, flailed in a whirlwind of death throes, and then finally toppled over."
            [/message]
            
            [sound]
                name=dragon-speak-short.ogg
            [/sound]
            
            [message]
                speaker="Edangor"
                message= _ "It seems that despite all my foresight, I too have underestimated you, Devanar."
            [/message]
            
            [message]
                speaker="Devanar"
                message= _ "So it is. Now, I'll ask again -  what has become of Adria? And what of Chamilix? And... What has become of my mother?"
            [/message]
            
            [sound]
                name=dragon-speak-short.ogg
            [/sound]
            
            [message]
                speaker="Edangor"
                message= _ "Heh. Still thinking about them? You are about to have far more significant problems than a couple of missing comrades. As for Kindra... Know that she keeps track of you, Devanar."
            [/message]
            
            [message]
                speaker="Raourshin Ohn"
                message= _ "You are hardly in any position to be making threats, imp."
            [/message]
            
            [sound]
                name=dragon-speak-long.ogg
            [/sound]
            
            [message]
                speaker="Edangor"
                message= _ "Nor am I levying any further threats against you, drake. With my death, Erya's control over the situation will come under heavy scrutiny. They will severely doubt her ability to handle this, and as such, provisions will be made for her expected failure. If you were to succeed in slaying Erya herself by the same stroke of luck that allowed you to defeat me, those provisions will be acted upon."
            [/message]
            
            [message]
                speaker="Devanar"
                message= _ "What does that mean, Edangor? Reinforcements? Another demon like you?"
            [/message]
            
            [sound]
                name=dragon-speak-short.ogg
            [/sound]
            
            [message]
                speaker="Edangor"
                message= _ "Heh. No. No, not like me at all. I know not what she is anymore. Once, a pyromancer. Now, an abomination."
            [/message]
            
            [message]
                speaker="Mal Idyr"
                message= _ "As brutally strong as your empire may be, we are making our stand against you now. And we may yet win. Whatever witch you send after us next will fall as well."
            [/message]
            
            [sound]
                name=dragon-speak-long.ogg
            [/sound]
            
            [message]
                speaker="Edangor"
                message= _ "She is responsible for the deaths of <i>millions</i>, lich. Parandel will become but the latest in a long line of settlements she has exterminated. Even with the Soul Jewel and the Rod of Justice in your grasp, the Warlord will obliterate you with ease."
            [/message]
            
            [sound]
                name=dragon-speak-short.ogg
            [/sound]
            
            [message]
                speaker="Edangor"
                message= _ "If you are smart... You will abandon these cities, run as far west as you can with the soldiers you have on hand, and hide."
            [/message]
            
            [message]
                speaker=narrator
                image="wesnoth-icon.png"
                message= _ "Finally succumbing to his wounds, Edangor let out a few more ragged breaths, and was still."
            [/message]
            
            [kill]
                id=Edangor
                animate=yes
            [/kill]
            
            [delay]
                time=2000
            [/delay]
            
            [message]
                speaker="Devanar"
                message= _ "The deaths of millions? Surely... Surely he exaggerated?"
            [/message]
            
            [message]
                speaker="Mal Idyr"
                message= _ "I hope so, Devanar. But there is a part of me that doubts that hope, and wonders how much of the Great Continent these warriors have already conquered. All of old Wesnoth? Even more? Those are not easy borders to hold, let alone expand."
            [/message]
            
            [message]
                speaker="Raourshin Ohn"
                message= _ "Regardless, the enemy before us is dead, and another assails New Elensia and Amurlai as we speak. Whoever this cryptic warlord is, she is a threat that can wait. The task at hand remains, my friends."
            [/message]
            
            [message]
                speaker="Devanar"
                message= _ "I suppose so."
            [/message]
            
            [message]
                speaker="Mal Idyr"
                message= _ "We should journey deeper into Krextin - the Soul Jewel is sensing someone."
            [/message]
            
            [message]
                speaker="Devanar"
                message= _ "Adria?!"
            [/message]
            
            [message]
                speaker="Mal Idyr"
                message= _ "No, my boy. I believe it's Chamilix."
            [/message]
            
            # reallow recruiting of everything
            [allow_recruit]
                side=1
                type=Saurian Scout,Aragwaith Spearman,Saurian Augur,Aragwaith Archer,Aragwaith Swordsman,Giant Leech,Saurian Skirmisher,Rhocobone,Ghost,Drake Glider,Dark Adept
            [/allow_recruit]
            
            {RESTORE_RECALL_LIST}
            
            {QUAKE "rumble.ogg"}
            
            [endlevel]
                result=victory
                save_replay=no
                carryover_report=no
                linger_mode=no
            [/endlevel]
            
            
        [/event]
        
        
    [/scenario]
    
